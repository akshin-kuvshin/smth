В прошлой версии я считал варианты в самом конце. Здесь же я попытаюсь считать их по ходу, образуя кумулятивные произведения. Таким образом, если на данном этапе мы не можем поделить пространство между двумя контрольными точками, то мы и дальше идти не будем, что частично оптимизирует код.